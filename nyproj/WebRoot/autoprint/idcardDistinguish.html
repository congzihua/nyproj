<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>身份证识别页面</title>
</head>
<link rel="stylesheet" href="./css/base.css">
<link rel="stylesheet" href="./css/user.css">
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css//keyboard.css">
<script src="js/jquery-3.2.1.min.js"></script>
<script src="./js/rem.js"></script>
<script src="./js/keyboard.js"></script>

<body>
    <div class="main">
        <div class="header">
            <div class="header-title">请将证件在相应位置扫描：身份证</div>

        </div>
        <div class="content">
            <div class="image-info"></div>
        </div>
        <div class="check">
            <div class="mid">
                <img src="./images/idcard.jpg" alt="">
                <div class="input-box"><input type="text" id="idInput"></div>
            </div>
            <!-- <button onClick="moveInfo()">下一步</button> -->
        </div>
        <div class="sky">
            <div class="clouds_one"></div>
            <div class="clouds_two"></div>
            <div class="clouds_three"></div>
            <div class="clouds_forth"></div>
            <div class="clouds_one top"></div>
            <div class="clouds_two top"></div>
            <div class="clouds_three top"></div>
            <div class="clouds_forth top"></div>
        </div>
    </div>
    <div class="time-box">
        <div class="an-time"></div>
        <span id="timenum">30</span>
    </div>
</body>
<script>
    var time = 30;
    var timer = null;
    var item = $('#timenum');
    var value = "";
    var inputTimer = null;
    var scanCertNo = '';
    var scanName = "";
    var CARD = "";
    item.text(time);
    timerStart();
    function timerStart() {
        if (time <= 0) {
            clearTimeout(timer);
            window.location.href = "autoprintIndex.html"
        } else {
            timer = setTimeout(() => {
                getCard()
                time -= 1;
                item.text(time);
                console.log(time)
                timerStart();
            }, 1000)
        }

    }


    function getCard() {
        var img1Base64;
        var httpServerPort = 8989;
        $.ajax({
            dataType: "JSONP",
            type: "get",
            url: "http://localhost:" + httpServerPort + "/api/ReadMsg",//接口服务器地址  参数: Fp=1读证内指纹，PhotoQuality 身份证头像质量，cardImg=1获取身份证正反面图片
            //contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function (data) {
                scanCertNo = data.cardno;
                scanName = data.name;
                if (scanCertNo == null || scanCertNo == undefined) {
                    alert("未能正确安装身份证识别设别");
                    return;
                }
                //成功执行undefined
                CARD = scanCertNo;
                moveInfo()
            },
            error: function (e) {
                //失败执行
                // window.location.href = "autoprintIndex.html"
                console.log(e.status + ',' + e.statusText);
            }
        });
    }

    $('#back').bind('click', function () {
        window.location.href = "autoprintIndex.html"
    });

    function moveInfo() {
        if (CARD) {
            window.location.href = "idcardDistinguishResult.html?card=" + CARD;
        } else {

        }
    }
    $('#idInput').on('focus', function () {
        $('#softkeyboard').show()
    })

</script>

</html>