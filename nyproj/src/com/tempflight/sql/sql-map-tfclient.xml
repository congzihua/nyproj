<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="tfClient">  
	<resultMap class="com.tempflight.entity.TempOrdertickets" id="ooTempOrdertickets">
		<result property="id" column="id"/>
	    <result property="tempFlightinfoId" column="TEMP_FLIGHTINFO_ID"/>
	     <result property="flightInfo" column="flight_info"/>	
	   <result property="name" column="NAME"/>
	   <result property="certType" column="CERT_TYPE"/>
	   <result property="certNo" column="CERT_NO"/>
	   <result property="linkphone" column="LINKPHONE"/>
	   <result property="vipFlag" column="VIP_FLAG"/>
	   <result property="status" column="STATUS"/>
	   <result property="remark" column="REMARK"/>
	   <result property="gate" column="GATE"/>	
	   <result property="createdate" column="CREATEDATE"/>
	   <result property="deleteFlag" column="DELETE_FLAG"/>	
	   <result property="luggSum" column="LUGG_SUM"/>	
	   <result property="weightSum" column="WEIGHT_SUM"/>
	     <result property="seatNum" column="SEAT_NUM"/>	
	     <result property="teamflag" column="TEAMFLAG"/>
	      <result property="teamName" column="TEAM_NAME"/>
	      <result property="bagNum" column="bag_num"/>
    </resultMap>
    <resultMap class="com.tempflight.entity.TempFlightinfo" id="ooTempFlightinfo">
	  <result property="id" column="id"/>
	     <result property="flightInfo" column="flight_info"/>
	      <result property="flightNo" column="flight_no"/>
	   <result property="origin" column="origin"/>
	   <result property="gateNo" column="gate_no"/>	
	   <result property="flightDate" column="flight_date"/>
	   <result property="flyTime" column="fly_time"/>
	   <result property="createTime" column="create_time"/>
	   <result property="deleteFlag" column="delete_flag"/>	
    </resultMap>
     <select id="tempFlightInfoList" parameterClass="com.tempflight.entity.TempOrderticketsKeyword" resultMap="ooTempFlightinfo">
      	select  id,flight_info,flight_no,origin,gate_no,flight_date,fly_time,create_time,delete_flag
      	from temp_flightinfo
      	 where  flight_date=#seleDate# and fly_time=#flyTime# and delete_flag!=1
      </select>
       <select id="tempFlightInfoById" parameterClass="java.lang.Integer" resultMap="ooTempFlightinfo">
      	select  id,flight_info,flight_no,origin,gate_no,flight_date,fly_time,create_time,delete_flag
      	from temp_flightinfo
      	 where  id=#id# 
      </select>
       <select id="queryTempOrdertickets" parameterClass="java.lang.Integer" resultMap="ooTempOrdertickets">
      	select   ID,TEMP_FLIGHTINFO_ID,STATUS,flight_info,NAME,CERT_TYPE,CERT_NO,
		  LINKPHONE,VIP_FLAG,REMARK,GATE,CREATEDATE,DELETE_FLAG,LUGG_SUM,WEIGHT_SUM,
		  SEAT_NUM,GATE_TIME,BAG_NUM,TEAM_NAME,TEAMFLAG
      	from temp_ordertickets
      	 where  TEMP_FLIGHTINFO_ID=#flightinfoId# and STATUS in (1,2,3,4,5,6,7)
      	 order by `STATUS`,flight_info,`NAME` 
      </select>
      
       <select id="tfAuthInfoIsHasTicketInfo" parameterClass="com.tempflight.entity.TempOrderticketsKeyword" resultClass="java.lang.Integer">
      	select  count(id) from temp_ordertickets
      	 where  CERT_TYPE=#certType# and CERT_NO=#certNo# 
      	 and TEMP_FLIGHTINFO_ID = #seleFlightInfo# and STATUS in (1,2,3,4,5,6,7)
      </select>
     
    <select id="queryTempOrderticketsById" parameterClass="java.lang.Integer" resultMap="ooTempOrdertickets">
      	select   ID,TEMP_FLIGHTINFO_ID,STATUS,flight_info,NAME,CERT_TYPE,CERT_NO,
		  LINKPHONE,VIP_FLAG,REMARK,GATE,CREATEDATE,DELETE_FLAG,LUGG_SUM,WEIGHT_SUM,
		  SEAT_NUM,GATE_TIME,BAG_NUM,TEAM_NAME,TEAMFLAG
      	from temp_ordertickets
      	 where  id=#id#  
      </select> 
       <insert id="insertTempOrderticket" parameterClass="com.tempflight.entity.TempOrdertickets">
       INSERT INTO temp_ordertickets (TEMP_FLIGHTINFO_ID,STATUS,flight_info,NAME,CERT_TYPE,CERT_NO,
		  LINKPHONE,VIP_FLAG,REMARK,GATE,CREATEDATE,DELETE_FLAG,TEAM_NAME,TEAMFLAG) 
    	VALUES(#tempFlightinfoId#,#status#,#flightInfo#, #name#, #certType#,#certNo#,
    	 #linkphone#, #vipFlag#,  #remark#,#gate#,current_timestamp(), '0',#teamName#,#teamflag#)
   		<selectKey resultClass="java.lang.Integer" keyProperty="id">     
        	SELECT LAST_INSERT_ID()
        </selectKey>  
    </insert> 
      <update id="editTempOrderticket" parameterClass="com.tempflight.entity.TempOrdertickets">
        update temp_ordertickets 
        set flight_info=#flightInfo#,
        	 NAME=#name#, CERT_TYPE=#certType#, CERT_NO=#certNo#, 
        	 LINKPHONE=#linkphone#, VIP_FLAG=#vipFlag#, 
			TEAMFLAG=#teamflag#,TEAM_NAME=#teamName#, 
			REMARK=#remark#,GATE=#gate#
 			where id=#id#
    </update>
    <update id="tgTempOrderticket" parameterClass="com.tempflight.entity.TempOrdertickets">
        update temp_ordertickets set SEAT_NUM = #seatNum# , FLIGHTINFO_ID=#flightinfoId#,TICKETPOINT_ID=#ticketpointId# <isNotEmpty property="status" prepend=",">STATUS=#status#</isNotEmpty>
 			where id=#id#
    </update>
    <update id="tpTemptdOpOrderticket" parameterClass="com.tempflight.entity.TempOrdertickets">
        update temp_ordertickets set STATUS=#status# where id=#id#
    </update>  
</sqlMap> 

